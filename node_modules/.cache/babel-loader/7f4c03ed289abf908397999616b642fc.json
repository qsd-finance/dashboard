{"ast":null,"code":"import _regeneratorRuntime from\"/Users/J/crypto/dashboard/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/J/crypto/dashboard/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/J/crypto/dashboard/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import{Header,Layout}from'@aragon/ui';import{getImplementation,getStatusOf,getTokenBalance,getTokenTotalSupply}from'../../utils/infura';import{QSG}from'../../constants/tokens';import{toTokenUnitsBN}from'../../utils/number';import BigNumber from'bignumber.js';import GovernanceHeader from'./Header';import ProposeCandidate from'./ProposeCandidate';import CandidateHistory from'./CandidateHistory';import IconHeader from'../common/IconHeader';import{canPropose}from'../../utils/gov';import{Section}from'../common';function Governance(_ref){var user=_ref.user;var _useState=useState(new BigNumber(0)),_useState2=_slicedToArray(_useState,2),stake=_useState2[0],setStake=_useState2[1];var _useState3=useState(new BigNumber(0)),_useState4=_slicedToArray(_useState3,2),totalStake=_useState4[0],setTotalStake=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),userStatus=_useState6[0],setUserStatus=_useState6[1];var _useState7=useState('0x'),_useState8=_slicedToArray(_useState7,2),implementation=_useState8[0],setImplementation=_useState8[1];useEffect(function(){if(user===''){setStake(new BigNumber(0));setUserStatus(0);return;}var isCancelled=false;// Changing to QSG stake\nfunction updateUserInfo(){return _updateUserInfo.apply(this,arguments);}function _updateUserInfo(){_updateUserInfo=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$Promise$all,_yield$Promise$all2,statusStr,stakeStr;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return Promise.all([getStatusOf(QSG.addr,user),getTokenBalance(QSG.addr,user)]);case 2:_yield$Promise$all=_context.sent;_yield$Promise$all2=_slicedToArray(_yield$Promise$all,2);statusStr=_yield$Promise$all2[0];stakeStr=_yield$Promise$all2[1];if(!isCancelled){setStake(toTokenUnitsBN(stakeStr,QSG.decimals));setUserStatus(parseInt(statusStr,10));}case 7:case\"end\":return _context.stop();}}},_callee);}));return _updateUserInfo.apply(this,arguments);}updateUserInfo();var id=setInterval(updateUserInfo,15000);// eslint-disable-next-line consistent-return\nreturn function(){isCancelled=true;clearInterval(id);};},[user]);useEffect(function(){var isCancelled=false;function updateUserInfo(){return _updateUserInfo2.apply(this,arguments);}function _updateUserInfo2(){_updateUserInfo2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _yield$Promise$all3,_yield$Promise$all4,totalStakeStr,implementationStr;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return Promise.all([getTokenTotalSupply(QSG.addr),getImplementation(QSG.addr)]);case 2:_yield$Promise$all3=_context2.sent;_yield$Promise$all4=_slicedToArray(_yield$Promise$all3,2);totalStakeStr=_yield$Promise$all4[0];implementationStr=_yield$Promise$all4[1];if(!isCancelled){setTotalStake(toTokenUnitsBN(totalStakeStr,QSG.decimals));setImplementation(implementationStr);}case 7:case\"end\":return _context2.stop();}}},_callee2);}));return _updateUserInfo2.apply(this,arguments);}updateUserInfo();var id=setInterval(updateUserInfo,15000);// eslint-disable-next-line consistent-return\nreturn function(){isCancelled=true;clearInterval(id);};},[user]);return/*#__PURE__*/React.createElement(Layout,null,/*#__PURE__*/React.createElement(IconHeader,{icon:/*#__PURE__*/React.createElement(\"i\",{className:\"fas fa-poll\"}),text:\"Governance\"}),/*#__PURE__*/React.createElement(GovernanceHeader,{stake:stake,totalStake:totalStake,accountStatus:userStatus,implementation:implementation}),canPropose(stake,totalStake)?/*#__PURE__*/React.createElement(ProposeCandidate,{user:user,stake:stake,totalStake:totalStake,accountStatus:userStatus}):'',/*#__PURE__*/React.createElement(Section,null,/*#__PURE__*/React.createElement(Header,{primary:\"Candidate History\"}),/*#__PURE__*/React.createElement(CandidateHistory,{user:user})));}export default Governance;","map":{"version":3,"sources":["/Users/J/crypto/dashboard/src/components/Governance/index.tsx"],"names":["React","useState","useEffect","Header","Layout","getImplementation","getStatusOf","getTokenBalance","getTokenTotalSupply","QSG","toTokenUnitsBN","BigNumber","GovernanceHeader","ProposeCandidate","CandidateHistory","IconHeader","canPropose","Section","Governance","user","stake","setStake","totalStake","setTotalStake","userStatus","setUserStatus","implementation","setImplementation","isCancelled","updateUserInfo","Promise","all","addr","statusStr","stakeStr","decimals","parseInt","id","setInterval","clearInterval","totalStakeStr","implementationStr"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Header, Layout } from '@aragon/ui';\n\nimport {\n  getImplementation,\n  getStatusOf,\n  getTokenBalance,\n  getTokenTotalSupply,\n} from '../../utils/infura';\nimport { QSG } from '../../constants/tokens';\nimport { toTokenUnitsBN } from '../../utils/number';\nimport BigNumber from 'bignumber.js';\nimport GovernanceHeader from './Header';\nimport ProposeCandidate from './ProposeCandidate';\nimport CandidateHistory from './CandidateHistory';\nimport IconHeader from '../common/IconHeader';\nimport { canPropose } from '../../utils/gov';\nimport { Section } from '../common';\n\nfunction Governance({ user }: { user: string }) {\n  const [stake, setStake] = useState(new BigNumber(0));\n  const [totalStake, setTotalStake] = useState(new BigNumber(0));\n  const [userStatus, setUserStatus] = useState(0);\n  const [implementation, setImplementation] = useState('0x');\n\n  useEffect(() => {\n    if (user === '') {\n      setStake(new BigNumber(0));\n      setUserStatus(0);\n      return;\n    }\n    let isCancelled = false;\n\n    // Changing to QSG stake\n    async function updateUserInfo() {\n      const [statusStr, stakeStr] = await Promise.all([\n        getStatusOf(QSG.addr, user),\n        getTokenBalance(QSG.addr, user),\n      ]);\n\n      if (!isCancelled) {\n        setStake(toTokenUnitsBN(stakeStr, QSG.decimals));\n        setUserStatus(parseInt(statusStr, 10));\n      }\n    }\n    updateUserInfo();\n    const id = setInterval(updateUserInfo, 15000);\n\n    // eslint-disable-next-line consistent-return\n    return () => {\n      isCancelled = true;\n      clearInterval(id);\n    };\n  }, [user]);\n\n  useEffect(() => {\n    let isCancelled = false;\n\n    async function updateUserInfo() {\n      const [totalStakeStr, implementationStr] = await Promise.all([\n        getTokenTotalSupply(QSG.addr),\n        getImplementation(QSG.addr),\n      ]);\n\n      if (!isCancelled) {\n        setTotalStake(toTokenUnitsBN(totalStakeStr, QSG.decimals));\n        setImplementation(implementationStr);\n      }\n    }\n    updateUserInfo();\n    const id = setInterval(updateUserInfo, 15000);\n\n    // eslint-disable-next-line consistent-return\n    return () => {\n      isCancelled = true;\n      clearInterval(id);\n    };\n  }, [user]);\n\n  return (\n    <Layout>\n      <IconHeader icon={<i className='fas fa-poll' />} text='Governance' />\n\n      <GovernanceHeader\n        stake={stake}\n        totalStake={totalStake}\n        accountStatus={userStatus}\n        implementation={implementation}\n      />\n\n      {canPropose(stake, totalStake) ? (\n        <ProposeCandidate\n          user={user}\n          stake={stake}\n          totalStake={totalStake}\n          accountStatus={userStatus}\n        />\n      ) : (\n        ''\n      )}\n\n      <Section>\n        <Header primary='Candidate History' />\n\n        <CandidateHistory user={user} />\n      </Section>\n    </Layout>\n  );\n}\n\nexport default Governance;\n"]},"metadata":{},"sourceType":"module"}