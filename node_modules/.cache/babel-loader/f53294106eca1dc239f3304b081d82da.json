{"ast":null,"code":"var _jsxFileName = \"/Users/J/crypto/dashboard/src/components/Governance/CandidateHistory.tsx\";\nimport React, { useEffect, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { Button, IconRight, DataView, useTheme } from '@aragon/ui';\nimport { getAllProposals, getApproveFor, getEpoch, getIsInitialized, getRejectFor, getTokenTotalSupply, getTotalBondedAt } from '../../utils/infura';\nimport { QSDS } from '../../constants/tokens';\nimport { AddressBlock } from '../common';\nimport { proposalStatus } from '../../utils/gov';\nimport BigNumber from 'bignumber.js';\n\nasync function formatProposals(epoch, proposals) {\n  const currentTotalStake = await getTokenTotalSupply(QSDS.addr);\n  const initializeds = await Promise.all(proposals.map(p => getIsInitialized(QSDS.addr, p.candidate)));\n  const approves = await Promise.all(proposals.map(p => getApproveFor(QSDS.addr, p.candidate)));\n  const rejecteds = await Promise.all(proposals.map(p => getRejectFor(QSDS.addr, p.candidate)));\n  const supplyAts = await Promise.all(proposals.map(async p => {\n    const at = p.start + p.period - 1;\n\n    if (epoch > at) {\n      return await getTotalBondedAt(QSDS.addr, at);\n    }\n\n    return currentTotalStake;\n  }));\n\n  for (let i = 0; i < proposals.length; i++) {\n    proposals[i].index = proposals.length - i;\n    proposals[i].start = parseInt(proposals[i].start);\n    proposals[i].period = parseInt(proposals[i].period);\n    proposals[i].status = proposalStatus(epoch, proposals[i].start, proposals[i].period, initializeds[i], new BigNumber(approves[i]), new BigNumber(rejecteds[i]), new BigNumber(supplyAts[i]));\n  }\n\n  return proposals;\n}\n\nfunction CandidateHistory({\n  user\n}) {\n  const theme = useTheme();\n  const isDark = theme._name === 'dark';\n  const history = useHistory();\n  const [proposals, setProposals] = useState([]);\n  const [page, setPage] = useState(0);\n  const [initialized, setInitialized] = useState(false);\n  useEffect(() => {\n    let isCancelled = false;\n\n    async function updateUserInfo() {\n      const [epochStr, allProposals] = await Promise.all([getEpoch(QSDS.addr), getAllProposals(QSDS.addr)]);\n\n      if (!isCancelled) {\n        const formattedProposals = await formatProposals(parseInt(epochStr), allProposals);\n        setProposals(formattedProposals);\n        setInitialized(true);\n      }\n    }\n\n    updateUserInfo();\n    const id = setInterval(updateUserInfo, 15000); // eslint-disable-next-line consistent-return\n\n    return () => {\n      isCancelled = true;\n      clearInterval(id);\n    };\n  }, [user]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: isDark ? 'table-container-dark' : undefined,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(DataView, {\n    fields: ['Proposal', 'Candidate', 'Proposed', 'Complete', 'Proposer', 'Status', ''],\n    status: initialized ? 'default' : 'loading' // @ts-ignore\n    ,\n    entries: proposals,\n    entriesPerPage: 10,\n    page: page,\n    onPageChange: setPage,\n    renderEntry: proposal => ['#' + proposal.index, /*#__PURE__*/React.createElement(AddressBlock, {\n      label: \"\",\n      address: proposal.candidate,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 11\n      }\n    }), proposal.start.toString(), (proposal.start + proposal.period).toString(), /*#__PURE__*/React.createElement(AddressBlock, {\n      label: \"\",\n      address: proposal.account,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 11\n      }\n    }), proposal.status, /*#__PURE__*/React.createElement(Button, {\n      wide: true,\n      icon: /*#__PURE__*/React.createElement(IconRight, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137,\n          columnNumber: 19\n        }\n      }),\n      label: \"Go To\",\n      onClick: () => {\n        history.push(`/governance/candidate/${proposal.candidate}`);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 11\n      }\n    })],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 7\n    }\n  }));\n}\n\nexport default CandidateHistory;","map":{"version":3,"sources":["/Users/J/crypto/dashboard/src/components/Governance/CandidateHistory.tsx"],"names":["React","useEffect","useState","useHistory","Button","IconRight","DataView","useTheme","getAllProposals","getApproveFor","getEpoch","getIsInitialized","getRejectFor","getTokenTotalSupply","getTotalBondedAt","QSDS","AddressBlock","proposalStatus","BigNumber","formatProposals","epoch","proposals","currentTotalStake","addr","initializeds","Promise","all","map","p","candidate","approves","rejecteds","supplyAts","at","start","period","i","length","index","parseInt","status","CandidateHistory","user","theme","isDark","_name","history","setProposals","page","setPage","initialized","setInitialized","isCancelled","updateUserInfo","epochStr","allProposals","formattedProposals","id","setInterval","clearInterval","undefined","proposal","toString","account","push"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { Button, IconRight, DataView, useTheme } from '@aragon/ui';\n\nimport {\n  getAllProposals,\n  getApproveFor,\n  getEpoch,\n  getIsInitialized,\n  getRejectFor,\n  getTokenTotalSupply,\n  getTotalBondedAt,\n} from '../../utils/infura';\nimport { QSDS } from '../../constants/tokens';\nimport { AddressBlock } from '../common';\nimport { proposalStatus } from '../../utils/gov';\nimport BigNumber from 'bignumber.js';\n\ntype CandidateHistoryProps = {\n  user: string;\n};\n\ntype Proposal = {\n  index: number;\n  candidate: string;\n  account: string;\n  start: number;\n  period: number;\n  status: string;\n};\n\nasync function formatProposals(\n  epoch: number,\n  proposals: any[]\n): Promise<Proposal[]> {\n\n  const currentTotalStake = await getTokenTotalSupply(QSDS.addr);\n  const initializeds = await Promise.all(\n    proposals.map((p) => getIsInitialized(QSDS.addr, p.candidate))\n  );\n  const approves = await Promise.all(\n    proposals.map((p) => getApproveFor(QSDS.addr, p.candidate))\n  );\n  const rejecteds = await Promise.all(\n    proposals.map((p) => getRejectFor(QSDS.addr, p.candidate))\n  );\n  const supplyAts = await Promise.all(\n    proposals.map(async (p) => {\n      const at = p.start + p.period - 1;\n      if (epoch > at) {\n        return await getTotalBondedAt(QSDS.addr, at);\n      }\n      return currentTotalStake;\n    })\n  );\n\n  for (let i = 0; i < proposals.length; i++) {\n    proposals[i].index = proposals.length - i;\n    proposals[i].start = parseInt(proposals[i].start);\n    proposals[i].period = parseInt(proposals[i].period);\n    proposals[i].status = proposalStatus(\n      epoch,\n      proposals[i].start,\n      proposals[i].period,\n      initializeds[i],\n      new BigNumber(approves[i]),\n      new BigNumber(rejecteds[i]),\n      new BigNumber(supplyAts[i])\n    );\n  }\n  return proposals;\n}\n\nfunction CandidateHistory({ user }: CandidateHistoryProps) {\n  const theme = useTheme();\n  const isDark = theme._name === 'dark';\n  const history = useHistory();\n  const [proposals, setProposals] = useState<Proposal[]>([]);\n  const [page, setPage] = useState(0);\n  const [initialized, setInitialized] = useState(false);\n\n  useEffect(() => {\n    let isCancelled = false;\n\n    async function updateUserInfo() {\n      const [epochStr, allProposals] = await Promise.all([\n        getEpoch(QSDS.addr),\n        getAllProposals(QSDS.addr),\n      ]);\n\n      if (!isCancelled) {\n        const formattedProposals = await formatProposals(\n          parseInt(epochStr),\n          allProposals\n        );\n        setProposals(formattedProposals);\n        setInitialized(true);\n      }\n    }\n    updateUserInfo();\n    const id = setInterval(updateUserInfo, 15000);\n\n    // eslint-disable-next-line consistent-return\n    return () => {\n      isCancelled = true;\n      clearInterval(id);\n    };\n  }, [user]);\n\n  return (\n    <div className={isDark ? 'table-container-dark' : undefined}>\n      <DataView\n        fields={[\n          'Proposal',\n          'Candidate',\n          'Proposed',\n          'Complete',\n          'Proposer',\n          'Status',\n          '',\n        ]}\n        status={initialized ? 'default' : 'loading'}\n        // @ts-ignore\n        entries={proposals}\n        entriesPerPage={10}\n        page={page}\n        onPageChange={setPage}\n        renderEntry={(proposal) => [\n          '#' + proposal.index,\n          <AddressBlock label='' address={proposal.candidate} />,\n          proposal.start.toString(),\n          (proposal.start + proposal.period).toString(),\n          <AddressBlock label='' address={proposal.account} />,\n          proposal.status,\n          <Button\n            wide\n            icon={<IconRight />}\n            label='Go To'\n            onClick={() => {\n              history.push(`/governance/candidate/${proposal.candidate}`);\n            }}\n          />,\n        ]}\n      />\n    </div>\n  );\n}\n\nexport default CandidateHistory;\n"]},"metadata":{},"sourceType":"module"}